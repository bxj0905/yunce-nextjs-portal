(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7142],{3968:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var s=a(5155),r=a(2115),l=a(8240),n=a(4823),i=a(6766);let c="yunce_ai_chat_sessions_v1";function o(){var e;let t="/yunce-nextjs-portal",a=e=>e.startsWith("http")||t&&e.startsWith(t+"/")?e:"".concat(t).concat(e.startsWith("/")?"":"/").concat(e),[o,d]=(0,r.useState)([]),[u,h]=(0,r.useState)(""),m=(0,r.useMemo)(()=>{var e;return null!==(e=o.find(e=>e.id===u))&&void 0!==e?e:null},[o,u]),b=null!==(e=null==m?void 0:m.messages)&&void 0!==e?e:[],[g,x]=(0,r.useState)(""),p=(0,r.useRef)(null),v="sk-ff6ce9a6a943401c852bc0f3229e7148",[f,y]=(0,r.useState)(v),[j,w]=(0,r.useState)(!1),N={primary:"chat-bubble-primary",secondary:"chat-bubble-secondary",accent:"chat-bubble-accent",neutral:"chat-bubble-neutral",info:"chat-bubble-info",success:"chat-bubble-success",warning:"chat-bubble-warning",error:"chat-bubble-error"},k=(0,r.useMemo)(()=>a("/images/user/user-02.jpg"),[t]),E=(0,r.useMemo)(()=>a("/images/logo/logo-icon.svg"),[t]),S=()=>{var e,t;let a=g.trim();if(!a||!m)return;if(!f){alert("请先设置 DeepSeek API Key");return}let s={id:"m-".concat(Date.now()),role:"user",text:a,tone:"primary"};d(e=>e.map(e=>e.id===u?{...e,title:0===e.messages.length?a.slice(0,20):e.title,messages:[...e.messages,s]}:e)),x("");let r=((null===(e=o.find(e=>e.id===u))||void 0===e?void 0:e.messages)||[]).concat(s).slice(-20).map(e=>({role:e.role,content:e.text}));w(!0),fetch("https://api.deepseek.com/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(f)},body:JSON.stringify({model:"deepseek-chat",messages:r,temperature:.7})}).then(async e=>{var t,a,s,r;if(!e.ok)throw Error(await e.text());let l=await e.json(),n=null!==(r=null==l?void 0:null===(s=l.choices)||void 0===s?void 0:null===(a=s[0])||void 0===a?void 0:null===(t=a.message)||void 0===t?void 0:t.content)&&void 0!==r?r:"";d(e=>e.map(e=>e.id===u?{...e,messages:[...e.messages,{id:"m-".concat(Date.now(),"-ai"),role:"assistant",text:n||"(无内容)",tone:"secondary"}]}:e))}).catch(e=>{d(t=>t.map(t=>t.id===u?{...t,messages:[...t.messages,{id:"m-".concat(Date.now(),"-err"),role:"assistant",text:"调用失败：".concat(String(e)),tone:"error"}]}:t))}).finally(()=>{var e;w(!1),null===(e=p.current)||void 0===e||e.scrollTo({top:p.current.scrollHeight,behavior:"smooth"})}),null===(t=p.current)||void 0===t||t.scrollTo({top:p.current.scrollHeight,behavior:"smooth"})};r.useEffect(()=>{try{let e=localStorage.getItem(c);if(e){let t=JSON.parse(e);d(t),t.length>0&&h(t[0].id)}else{let e={id:"s-".concat(Date.now()),title:"新的对话",createdAt:Date.now(),messages:[{id:"m-".concat(Date.now()),role:"assistant",text:"您好，我是云策AI助手。有什么可以帮您？",tone:"info"}]};d([e]),h(e.id)}}catch(e){}},[]),r.useEffect(()=>{try{localStorage.setItem(c,JSON.stringify(o))}catch(e){}},[o]),r.useEffect(()=>{try{let e=localStorage.getItem("DEEPSEEK_API_KEY");e?y(e):y(v)}catch(e){y(v)}},[]);let D=()=>{let e={id:"s-".concat(Date.now()),title:"新的对话",createdAt:Date.now(),messages:[]};d(t=>[e,...t]),h(e.id)},_=e=>{if(d(t=>t.filter(t=>t.id!==e)),u===e){var t,a;h(null!==(a=null===(t=o.filter(t=>t.id!==e)[0])||void 0===t?void 0:t.id)&&void 0!==a?a:"")}},I=(e,t)=>{d(a=>a.map(a=>a.id===e?{...a,title:t}:a))};return(0,s.jsxs)("div",{className:"flex flex-col gap-4 sm:gap-6 h-[calc(100vh-2rem)]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold text-gray-800 dark:text-white",children:"大模型对话"}),(0,s.jsx)("button",{className:"btn btn-sm",onClick:D,children:"新建会话"})]}),(0,s.jsx)("div",{className:"rounded-2xl border border-gray-200 p-2 dark:border-gray-800 bg-white dark:bg-white/[0.03]",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"dropdown",children:[(0,s.jsx)("div",{tabIndex:0,role:"button",className:"btn btn-sm",children:"会话历史"}),(0,s.jsx)("ul",{tabIndex:0,className:"dropdown-content menu p-2 shadow bg-base-100 rounded-box w-72 max-h-80 overflow-y-auto",children:o.map(e=>(0,s.jsxs)("li",{children:[(0,s.jsx)("a",{onClick:()=>h(e.id),className:"".concat(e.id===u?"active":""),children:(0,s.jsx)("span",{className:"truncate",children:e.title||"未命名会话"})}),e.id===u&&(0,s.jsxs)("div",{className:"px-2 py-2 flex items-center gap-2",children:[(0,s.jsx)("input",{className:"input input-bordered input-xs w-full",defaultValue:e.title,onBlur:t=>I(e.id,t.target.value.trim()||"未命名会话")}),(0,s.jsx)("button",{className:"btn btn-xs",onClick:()=>_(e.id),children:"删"})]})]},e.id))})]}),(0,s.jsx)("button",{className:"btn btn-sm",onClick:D,children:"新建会话"})]})}),(0,s.jsxs)("section",{className:"flex-1 flex flex-col",children:[(0,s.jsx)("div",{className:"rounded-2xl border border-gray-200 p-3 dark:border-gray-800 bg-white dark:bg-white/[0.03] mb-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{className:"input input-bordered w-full",placeholder:"请输入 DeepSeek API Key（仅保存在本地）",value:f,onChange:e=>y(e.target.value)}),(0,s.jsx)("button",{className:"btn",onClick:()=>{try{localStorage.setItem("DEEPSEEK_API_KEY",f.trim()),alert("API Key 已保存到本地浏览器")}catch(e){}},children:"保存"})]})}),(0,s.jsx)("div",{ref:p,className:"flex-1 overflow-y-auto rounded-2xl border border-gray-200 p-4 dark:border-gray-800 bg-white dark:bg-white/[0.03]",children:(0,s.jsx)("div",{className:"space-y-4",children:b.map(e=>{var t;let a="user"===e.role,r=N[null!==(t=e.tone)&&void 0!==t?t:a?"primary":"secondary"];return(0,s.jsxs)("div",{className:"chat ".concat(a?"chat-end":"chat-start"),children:[(0,s.jsx)("div",{className:"chat-image avatar",children:(0,s.jsx)("div",{className:"w-10 rounded-full overflow-hidden bg-gray-100 dark:bg-gray-800",children:(0,s.jsx)(i.default,{src:a?k:E,alt:a?"User":"AI",width:40,height:40})})}),(0,s.jsx)("div",{className:"chat-bubble ".concat(r),children:(0,s.jsx)(l.oz,{remarkPlugins:[n.A],children:e.text})})]},e.id)})})}),(0,s.jsx)("div",{className:"rounded-2xl border border-gray-200 p-3 mt-4 dark:border-gray-800 bg-white dark:bg-white/[0.03]",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{className:"input input-bordered w-full",placeholder:"输入消息，按 Enter 发送",value:g,onChange:e=>x(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),S())}}),(0,s.jsx)("button",{className:"btn btn-primary",onClick:S,disabled:!m||j,children:j?"发送中":"发送"})]})})]})]})}},7372:(e,t,a)=>{Promise.resolve().then(a.bind(a,3968))}},e=>{var t=t=>e(e.s=t);e.O(0,[3063,9788,8441,1684,7358],()=>t(7372)),_N_E=e.O()}]);