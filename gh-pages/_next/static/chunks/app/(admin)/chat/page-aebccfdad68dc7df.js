(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7142],{1469:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{default:function(){return o},getImageProps:function(){return i}});let l=a(8229),r=a(8883),s=a(3063),n=l._(a(1193));function i(e){let{props:t}=(0,r.getImgProps)(e,{defaultLoader:n.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/yunce-nextjs-portal/_next/image/",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,a]of Object.entries(t))void 0===a&&delete t[e];return{props:t}}let o=s.Image},3968:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var l=a(5155),r=a(2115),s=a(6766);let n="yunce_ai_chat_sessions_v1";function i(){var e;let t="/yunce-nextjs-portal",a=e=>e.startsWith("http")||t&&e.startsWith(t+"/")?e:"".concat(t).concat(e.startsWith("/")?"":"/").concat(e),[i,o]=(0,r.useState)([]),[c,d]=(0,r.useState)(""),u=(0,r.useMemo)(()=>{var e;return null!==(e=i.find(e=>e.id===c))&&void 0!==e?e:null},[i,c]),m=null!==(e=null==u?void 0:u.messages)&&void 0!==e?e:[],[f,h]=(0,r.useState)(""),g=(0,r.useRef)(null),b="sk-ff6ce9a6a943401c852bc0f3229e7148",[p,v]=(0,r.useState)(b),[x,y]=(0,r.useState)(!1),j=(0,r.useMemo)(()=>a("/images/user/user-02.jpg"),[t]),w=(0,r.useMemo)(()=>a("/images/logo/logo-icon.svg"),[t]),N=()=>{var e,t;let a=f.trim();if(!a||!u)return;if(!p){alert("请先设置 DeepSeek API Key");return}let l={id:"m-".concat(Date.now()),role:"user",text:a,tone:"primary"};o(e=>e.map(e=>e.id===c?{...e,title:0===e.messages.length?a.slice(0,20):e.title,messages:[...e.messages,l]}:e)),h("");let r=((null===(e=i.find(e=>e.id===c))||void 0===e?void 0:e.messages)||[]).concat(l).slice(-20).map(e=>({role:e.role,content:e.text}));y(!0),fetch("https://api.deepseek.com/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(p)},body:JSON.stringify({model:"deepseek-chat",messages:r,temperature:.7})}).then(async e=>{var t,a,l,r;if(!e.ok)throw Error(await e.text());let s=await e.json(),n=null!==(r=null==s?void 0:null===(l=s.choices)||void 0===l?void 0:null===(a=l[0])||void 0===a?void 0:null===(t=a.message)||void 0===t?void 0:t.content)&&void 0!==r?r:"";o(e=>e.map(e=>e.id===c?{...e,messages:[...e.messages,{id:"m-".concat(Date.now(),"-ai"),role:"assistant",text:n||"(无内容)",tone:"secondary"}]}:e))}).catch(e=>{o(t=>t.map(t=>t.id===c?{...t,messages:[...t.messages,{id:"m-".concat(Date.now(),"-err"),role:"assistant",text:"调用失败：".concat(String(e)),tone:"error"}]}:t))}).finally(()=>{var e;y(!1),null===(e=g.current)||void 0===e||e.scrollTo({top:g.current.scrollHeight,behavior:"smooth"})}),null===(t=g.current)||void 0===t||t.scrollTo({top:g.current.scrollHeight,behavior:"smooth"})};r.useEffect(()=>{try{let e=localStorage.getItem(n);if(e){let t=JSON.parse(e);o(t),t.length>0&&d(t[0].id)}else{let e={id:"s-".concat(Date.now()),title:"新的对话",createdAt:Date.now(),messages:[{id:"m-".concat(Date.now()),role:"assistant",text:"您好，我是云策AI助手。有什么可以帮您？",tone:"info"}]};o([e]),d(e.id)}}catch(e){}},[]),r.useEffect(()=>{try{localStorage.setItem(n,JSON.stringify(i))}catch(e){}},[i]),r.useEffect(()=>{try{let e=localStorage.getItem("DEEPSEEK_API_KEY");e?v(e):v(b)}catch(e){v(b)}},[]);let k=()=>{let e={id:"s-".concat(Date.now()),title:"新的对话",createdAt:Date.now(),messages:[]};o(t=>[e,...t]),d(e.id)},_=e=>{if(o(t=>t.filter(t=>t.id!==e)),c===e){var t,a;d(null!==(a=null===(t=i.filter(t=>t.id!==e)[0])||void 0===t?void 0:t.id)&&void 0!==a?a:"")}},S=(e,t)=>{o(a=>a.map(a=>a.id===e?{...a,title:t}:a))};return(0,l.jsxs)("div",{className:"flex flex-col gap-4 sm:gap-6 h-[calc(100vh-2rem)]",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h1",{className:"text-2xl font-semibold text-gray-800 dark:text-white",children:"大模型对话"}),(0,l.jsx)("button",{className:"btn btn-sm",onClick:k,children:"新建会话"})]}),(0,l.jsx)("div",{className:"rounded-2xl border border-gray-200 p-2 dark:border-gray-800 bg-white dark:bg-white/[0.03]",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("div",{className:"dropdown",children:[(0,l.jsx)("div",{tabIndex:0,role:"button",className:"btn btn-sm",children:"会话历史"}),(0,l.jsx)("ul",{tabIndex:0,className:"dropdown-content menu p-2 shadow bg-base-100 rounded-box w-72 max-h-80 overflow-y-auto",children:i.map(e=>(0,l.jsxs)("li",{children:[(0,l.jsx)("a",{onClick:()=>d(e.id),className:"".concat(e.id===c?"active":""),children:(0,l.jsx)("span",{className:"truncate",children:e.title||"未命名会话"})}),e.id===c&&(0,l.jsxs)("div",{className:"px-2 py-2 flex items-center gap-2",children:[(0,l.jsx)("input",{className:"input input-bordered input-xs w-full",defaultValue:e.title,onBlur:t=>S(e.id,t.target.value.trim()||"未命名会话")}),(0,l.jsx)("button",{className:"btn btn-xs",onClick:()=>_(e.id),children:"删"})]})]},e.id))})]}),(0,l.jsx)("button",{className:"btn btn-sm",onClick:k,children:"新建会话"})]})}),(0,l.jsxs)("section",{className:"flex-1 flex flex-col",children:[(0,l.jsx)("div",{className:"rounded-2xl border border-gray-200 p-3 dark:border-gray-800 bg-white dark:bg-white/[0.03] mb-3",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("input",{className:"input input-bordered w-full",placeholder:"请输入 DeepSeek API Key（仅保存在本地）",value:p,onChange:e=>v(e.target.value)}),(0,l.jsx)("button",{className:"btn",onClick:()=>{try{localStorage.setItem("DEEPSEEK_API_KEY",p.trim()),alert("API Key 已保存到本地浏览器")}catch(e){}},children:"保存"})]})}),(0,l.jsx)("div",{ref:g,className:"flex-1 overflow-y-auto rounded-2xl border border-gray-200 p-4 dark:border-gray-800 bg-white dark:bg-white/[0.03]",children:(0,l.jsx)("div",{className:"space-y-4",children:m.map(e=>{var t;let a="user"===e.role,r="chat-bubble-".concat(null!==(t=e.tone)&&void 0!==t?t:a?"primary":"secondary");return(0,l.jsxs)("div",{className:"chat ".concat(a?"chat-end":"chat-start"),children:[(0,l.jsx)("div",{className:"chat-image avatar",children:(0,l.jsx)("div",{className:"w-10 rounded-full overflow-hidden bg-gray-100 dark:bg-gray-800",children:(0,l.jsx)(s.default,{src:a?j:w,alt:a?"User":"AI",width:40,height:40})})}),(0,l.jsx)("div",{className:"chat-bubble ".concat(r),children:e.text})]},e.id)})})}),(0,l.jsx)("div",{className:"rounded-2xl border border-gray-200 p-3 mt-4 dark:border-gray-800 bg-white dark:bg-white/[0.03]",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("input",{className:"input input-bordered w-full",placeholder:"输入消息，按 Enter 发送",value:f,onChange:e=>h(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),N())}}),(0,l.jsx)("button",{className:"btn btn-primary",onClick:N,disabled:!u||x,children:x?"发送中":"发送"})]})})]})]})}},6654:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return r}});let l=a(2115);function r(e,t){let a=(0,l.useRef)(null),r=(0,l.useRef)(null);return(0,l.useCallback)(l=>{if(null===l){let e=a.current;e&&(a.current=null,e());let t=r.current;t&&(r.current=null,t())}else e&&(a.current=s(e,l)),t&&(r.current=s(t,l))},[e,t])}function s(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let a=e(t);return"function"==typeof a?a:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6766:(e,t,a)=>{"use strict";a.d(t,{default:()=>r.a});var l=a(1469),r=a.n(l)},7372:(e,t,a)=>{Promise.resolve().then(a.bind(a,3968))}},e=>{var t=t=>e(e.s=t);e.O(0,[3063,8441,1684,7358],()=>t(7372)),_N_E=e.O()}]);