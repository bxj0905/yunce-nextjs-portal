(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7142],{1469:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{default:function(){return c},getImageProps:function(){return i}});let r=a(8229),l=a(8883),s=a(3063),n=r._(a(1193));function i(e){let{props:t}=(0,l.getImgProps)(e,{defaultLoader:n.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/yunce-nextjs-portal/_next/image/",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,a]of Object.entries(t))void 0===a&&delete t[e];return{props:t}}let c=s.Image},3968:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var r=a(5155),l=a(2115),s=a(6766);let n="yunce_ai_chat_sessions_v1";function i(){var e;let t="/yunce-nextjs-portal",a=e=>e.startsWith("http")||t&&e.startsWith(t+"/")?e:"".concat(t).concat(e.startsWith("/")?"":"/").concat(e),[i,c]=(0,l.useState)([]),[o,d]=(0,l.useState)(""),u=(0,l.useMemo)(()=>{var e;return null!==(e=i.find(e=>e.id===o))&&void 0!==e?e:null},[i,o]),m=null!==(e=null==u?void 0:u.messages)&&void 0!==e?e:[],[b,h]=(0,l.useState)(""),f=(0,l.useRef)(null),g="sk-ff6ce9a6a943401c852bc0f3229e7148",[p,v]=(0,l.useState)(g),[x,y]=(0,l.useState)(!1),j={primary:"chat-bubble-primary",secondary:"chat-bubble-secondary",accent:"chat-bubble-accent",neutral:"chat-bubble-neutral",info:"chat-bubble-info",success:"chat-bubble-success",warning:"chat-bubble-warning",error:"chat-bubble-error"},w=(0,l.useMemo)(()=>a("/images/user/user-02.jpg"),[t]),N=(0,l.useMemo)(()=>a("/images/logo/logo-icon.svg"),[t]),k=()=>{var e,t;let a=b.trim();if(!a||!u)return;if(!p){alert("请先设置 DeepSeek API Key");return}let r={id:"m-".concat(Date.now()),role:"user",text:a,tone:"primary"};c(e=>e.map(e=>e.id===o?{...e,title:0===e.messages.length?a.slice(0,20):e.title,messages:[...e.messages,r]}:e)),h("");let l=((null===(e=i.find(e=>e.id===o))||void 0===e?void 0:e.messages)||[]).concat(r).slice(-20).map(e=>({role:e.role,content:e.text}));y(!0),fetch("https://api.deepseek.com/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(p)},body:JSON.stringify({model:"deepseek-chat",messages:l,temperature:.7})}).then(async e=>{var t,a,r,l;if(!e.ok)throw Error(await e.text());let s=await e.json(),n=null!==(l=null==s?void 0:null===(r=s.choices)||void 0===r?void 0:null===(a=r[0])||void 0===a?void 0:null===(t=a.message)||void 0===t?void 0:t.content)&&void 0!==l?l:"";c(e=>e.map(e=>e.id===o?{...e,messages:[...e.messages,{id:"m-".concat(Date.now(),"-ai"),role:"assistant",text:n||"(无内容)",tone:"secondary"}]}:e))}).catch(e=>{c(t=>t.map(t=>t.id===o?{...t,messages:[...t.messages,{id:"m-".concat(Date.now(),"-err"),role:"assistant",text:"调用失败：".concat(String(e)),tone:"error"}]}:t))}).finally(()=>{var e;y(!1),null===(e=f.current)||void 0===e||e.scrollTo({top:f.current.scrollHeight,behavior:"smooth"})}),null===(t=f.current)||void 0===t||t.scrollTo({top:f.current.scrollHeight,behavior:"smooth"})};l.useEffect(()=>{try{let e=localStorage.getItem(n);if(e){let t=JSON.parse(e);c(t),t.length>0&&d(t[0].id)}else{let e={id:"s-".concat(Date.now()),title:"新的对话",createdAt:Date.now(),messages:[{id:"m-".concat(Date.now()),role:"assistant",text:"您好，我是云策AI助手。有什么可以帮您？",tone:"info"}]};c([e]),d(e.id)}}catch(e){}},[]),l.useEffect(()=>{try{localStorage.setItem(n,JSON.stringify(i))}catch(e){}},[i]),l.useEffect(()=>{try{let e=localStorage.getItem("DEEPSEEK_API_KEY");e?v(e):v(g)}catch(e){v(g)}},[]);let _=()=>{let e={id:"s-".concat(Date.now()),title:"新的对话",createdAt:Date.now(),messages:[]};c(t=>[e,...t]),d(e.id)},S=e=>{if(c(t=>t.filter(t=>t.id!==e)),o===e){var t,a;d(null!==(a=null===(t=i.filter(t=>t.id!==e)[0])||void 0===t?void 0:t.id)&&void 0!==a?a:"")}},E=(e,t)=>{c(a=>a.map(a=>a.id===e?{...a,title:t}:a))};return(0,r.jsxs)("div",{className:"flex flex-col gap-4 sm:gap-6 h-[calc(100vh-2rem)]",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold text-gray-800 dark:text-white",children:"大模型对话"}),(0,r.jsx)("button",{className:"btn btn-sm",onClick:_,children:"新建会话"})]}),(0,r.jsx)("div",{className:"rounded-2xl border border-gray-200 p-2 dark:border-gray-800 bg-white dark:bg-white/[0.03]",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"dropdown",children:[(0,r.jsx)("div",{tabIndex:0,role:"button",className:"btn btn-sm",children:"会话历史"}),(0,r.jsx)("ul",{tabIndex:0,className:"dropdown-content menu p-2 shadow bg-base-100 rounded-box w-72 max-h-80 overflow-y-auto",children:i.map(e=>(0,r.jsxs)("li",{children:[(0,r.jsx)("a",{onClick:()=>d(e.id),className:"".concat(e.id===o?"active":""),children:(0,r.jsx)("span",{className:"truncate",children:e.title||"未命名会话"})}),e.id===o&&(0,r.jsxs)("div",{className:"px-2 py-2 flex items-center gap-2",children:[(0,r.jsx)("input",{className:"input input-bordered input-xs w-full",defaultValue:e.title,onBlur:t=>E(e.id,t.target.value.trim()||"未命名会话")}),(0,r.jsx)("button",{className:"btn btn-xs",onClick:()=>S(e.id),children:"删"})]})]},e.id))})]}),(0,r.jsx)("button",{className:"btn btn-sm",onClick:_,children:"新建会话"})]})}),(0,r.jsxs)("section",{className:"flex-1 flex flex-col",children:[(0,r.jsx)("div",{className:"rounded-2xl border border-gray-200 p-3 dark:border-gray-800 bg-white dark:bg-white/[0.03] mb-3",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{className:"input input-bordered w-full",placeholder:"请输入 DeepSeek API Key（仅保存在本地）",value:p,onChange:e=>v(e.target.value)}),(0,r.jsx)("button",{className:"btn",onClick:()=>{try{localStorage.setItem("DEEPSEEK_API_KEY",p.trim()),alert("API Key 已保存到本地浏览器")}catch(e){}},children:"保存"})]})}),(0,r.jsx)("div",{ref:f,className:"flex-1 overflow-y-auto rounded-2xl border border-gray-200 p-4 dark:border-gray-800 bg-white dark:bg-white/[0.03]",children:(0,r.jsx)("div",{className:"space-y-4",children:m.map(e=>{var t;let a="user"===e.role,l=j[null!==(t=e.tone)&&void 0!==t?t:a?"primary":"secondary"];return(0,r.jsxs)("div",{className:"chat ".concat(a?"chat-end":"chat-start"),children:[(0,r.jsx)("div",{className:"chat-image avatar",children:(0,r.jsx)("div",{className:"w-10 rounded-full overflow-hidden bg-gray-100 dark:bg-gray-800",children:(0,r.jsx)(s.default,{src:a?w:N,alt:a?"User":"AI",width:40,height:40})})}),(0,r.jsx)("div",{className:"chat-bubble ".concat(l),children:e.text})]},e.id)})})}),(0,r.jsx)("div",{className:"rounded-2xl border border-gray-200 p-3 mt-4 dark:border-gray-800 bg-white dark:bg-white/[0.03]",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{className:"input input-bordered w-full",placeholder:"输入消息，按 Enter 发送",value:b,onChange:e=>h(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),k())}}),(0,r.jsx)("button",{className:"btn btn-primary",onClick:k,disabled:!u||x,children:x?"发送中":"发送"})]})})]})]})}},6654:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return l}});let r=a(2115);function l(e,t){let a=(0,r.useRef)(null),l=(0,r.useRef)(null);return(0,r.useCallback)(r=>{if(null===r){let e=a.current;e&&(a.current=null,e());let t=l.current;t&&(l.current=null,t())}else e&&(a.current=s(e,r)),t&&(l.current=s(t,r))},[e,t])}function s(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let a=e(t);return"function"==typeof a?a:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6766:(e,t,a)=>{"use strict";a.d(t,{default:()=>l.a});var r=a(1469),l=a.n(r)},7372:(e,t,a)=>{Promise.resolve().then(a.bind(a,3968))}},e=>{var t=t=>e(e.s=t);e.O(0,[3063,8441,1684,7358],()=>t(7372)),_N_E=e.O()}]);